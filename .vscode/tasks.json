// NOTE: VSCode tasks.json does not provide a native compound task that terminates
// all running terminals/tasks; use the explicit Stop Everything/Stop All tasks below.
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start Everything + CLI",
      "dependsOn": [
        "traceroute-visualizer:dev",
        "traceroute-visualizer:open-browser",
        "polycom-yealink-mikrotik:dev",
        "freepbx-deploy-backend:dev",
        "freepbx-deploy-ui:dev",
        "freepbx-tools-manager:cli",
        "webscraper:dev",
        "webscraper:ticket-api",
        "webscraper:ticket-ui"
      ],
      "dependsOrder": "parallel",
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "traceroute-visualizer:dev",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "npm.cmd run dev -- --port 5175"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "▲ Next\\.js",
            "endsPattern": "Ready in"
          }
        }
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/traceroute-visualizer-main/traceroute-visualizer-main"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "traceroute-visualizer:open-browser",
      "type": "process",
      "command": "cmd.exe",
      "dependsOn": [
        "traceroute-visualizer:dev"
      ],
      "dependsOrder": "sequence",
      "args": [
        "/d",
        "/c",
        "for %%U in (http://localhost:5174 http://localhost:5175 http://localhost:5173) do start \"\" \"%%U\""
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "polycom-yealink-mikrotik:dev",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "npm.cmd run dev -- --port 5173"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "VITE v",
            "endsPattern": "Local:\\s+http://"
          }
        }
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/PolycomYealinkMikrotikSwitchConfig-main/PolycomYealinkMikrotikSwitchConfig-main"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "freepbx-deploy-backend:dev",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if exist .venv-backend\\Scripts\\python.exe (.venv-backend\\Scripts\\python.exe --version && .venv-backend\\Scripts\\python.exe -m uvicorn freepbx_deploy_backend.main:app --reload --host 127.0.0.1 --port 8002) else if exist .venv\\Scripts\\python.exe (.venv\\Scripts\\python.exe --version && .venv\\Scripts\\python.exe -m uvicorn freepbx_deploy_backend.main:app --reload --host 127.0.0.1 --port 8002) else if exist venv\\Scripts\\python.exe (venv\\Scripts\\python.exe --version && venv\\Scripts\\python.exe -m uvicorn freepbx_deploy_backend.main:app --reload --host 127.0.0.1 --port 8002) else (py -3 --version && py -3 -m uvicorn freepbx_deploy_backend.main:app --reload --host 127.0.0.1 --port 8002)"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "INFO:\\s+Started server process",
            "endsPattern": "INFO:\\s+Uvicorn running on"
          }
        }
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/freepbx-deploy-backend"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "CMD Shell (venv)",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/k",
        "if exist .venv-webscraper\\Scripts\\activate.bat (call .venv-webscraper\\Scripts\\activate.bat) else (echo [ERROR] Missing .venv-webscraper. Run \"webscraper:venv+deps\" first.)"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:dev",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if not exist .venv-webscraper\\Scripts\\activate.bat (echo [ERROR] Missing .venv-webscraper. Run \"webscraper:venv+deps\" first. & exit /b 1) && call .venv-webscraper\\Scripts\\activate.bat && python -m webscraper.ultimate_scraper"
      ],
      "problemMatcher": [],
      "isBackground": false,
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "freepbx-deploy-ui:dev",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "npm.cmd run dev -- --port 5174"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "VITE v",
            "endsPattern": "Local:\\s+http://"
          }
        }
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/freepbx-deploy-ui"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "freepbx-tools-manager:cli",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "py -3 freepbx_tools_manager.py"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "M A N A G E R",
            "endsPattern": "Main Menu:"
          }
        }
      ],
      "isBackground": true,
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:ticket-api",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if exist .venv-webscraper\\Scripts\\python.exe (.venv-webscraper\\Scripts\\python.exe webscraper\\ticket_api\\db_init.py && .venv-webscraper\\Scripts\\python.exe -m webscraper.ticket_api.app --host 127.0.0.1 --port 8787 --reload --db webscraper\\output\\tickets.sqlite) else (py -3 webscraper\\ticket_api\\db_init.py && py -3 -m webscraper.ticket_api.app --host 127.0.0.1 --port 8787 --reload --db webscraper\\output\\tickets.sqlite)"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "INFO:\\s+Started server process",
            "endsPattern": "INFO:\\s+Uvicorn running on"
          }
        }
      ],
      "isBackground": true,
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "webscraper-api",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:ticket-db:init",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if exist .venv-webscraper\\Scripts\\python.exe (.venv-webscraper\\Scripts\\python.exe webscraper\\ticket_api\\db_init.py) else (py -3 webscraper\\ticket_api\\db_init.py)"
      ],
      "problemMatcher": [],
      "isBackground": false,
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "webscraper-api-debug",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:ticket-api (debug)",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if exist .venv-webscraper\\Scripts\\python.exe (.venv-webscraper\\Scripts\\python.exe webscraper\\ticket_api\\db_init.py && .venv-webscraper\\Scripts\\python.exe -m uvicorn webscraper.ticket_api.app:app --host 127.0.0.1 --port 8787) else (py -3 webscraper\\ticket_api\\db_init.py && py -3 -m uvicorn webscraper.ticket_api.app:app --host 127.0.0.1 --port 8787)"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "INFO:\\s+Started server process",
            "endsPattern": "INFO:\\s+Uvicorn running on"
          }
        }
      ],
      "isBackground": true,
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "webscraper-api-debug",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:ticket-api (debugpy)",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if exist .venv-webscraper\\Scripts\\python.exe (.venv-webscraper\\Scripts\\python.exe -m debugpy --listen 5678 --wait-for-client -m uvicorn webscraper.ticket_api.app:app --host 127.0.0.1 --port 8787) else (py -3 -m debugpy --listen 5678 --wait-for-client -m uvicorn webscraper.ticket_api.app:app --host 127.0.0.1 --port 8787)"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "debugpy",
            "endsPattern": "Waiting for client"
          }
        }
      ],
      "isBackground": true,
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "webscraper-api-debug",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:ticket-ui",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "set TICKET_API_PROXY_TARGET=http://127.0.0.1:8787&& npm.cmd run dev"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "▲ Next\\.js",
            "endsPattern": "Ready in"
          }
        }
      ],
      "isBackground": true,
      "options": { "cwd": "${workspaceFolder}/webscraper/ticket-ui" },
      "presentation": {
        "panel": "dedicated",
        "group": "webscraper-ui",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "ticket-ui:dev (debug)",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "set TICKET_API_PROXY_TARGET=http://127.0.0.1:8787&& npm.cmd run dev"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "▲ Next\\.js",
            "endsPattern": "Ready in"
          }
        }
      ],
      "isBackground": true,
      "options": { "cwd": "${workspaceFolder}/webscraper/ticket-ui" },
      "presentation": {
        "panel": "dedicated",
        "group": "webscraper-ui-debug",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "Stop All",
      "dependsOn": ["Stop Everything"],
      "dependsOrder": "parallel",
      "problemMatcher": [],
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "Stop Everything",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "for %%P in (3000 5173 5174 5175 8002 8787) do for /f \"tokens=5\" %%A in ('netstat -ano ^| findstr /R /C:\":%%P \" ^| findstr LISTENING') do taskkill /F /PID %%A >NUL 2>&1 & for /f \"tokens=2 delims==;\" %%A in ('wmic process where \"CommandLine like '%%freepbx_tools_manager.py%%'\" get ProcessId /value ^| find \"ProcessId\"') do taskkill /F /PID %%A >NUL 2>&1"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:test all (cmd)",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "call scripts\\test_webscraper_cmd.bat"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:test all (cmd) (live cookies)",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "set WEBSCRAPER_LIVE_COOKIES=1 && call scripts\\test_webscraper_cmd.bat"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:venv+deps",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if not exist .venv-webscraper (py -3.12 -m venv .venv-webscraper) && .venv-webscraper\\Scripts\\python.exe -m pip install -U pip && .venv-webscraper\\Scripts\\pip.exe install -r webscraper\\requirements.txt"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:smoke",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if not exist .venv-webscraper\\Scripts\\activate.bat (echo [ERROR] Missing .venv-webscraper. Run \"webscraper:venv+deps\" first. & exit /b 1) && call .venv-webscraper\\Scripts\\activate.bat && python -m webscraper.smoke_test"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:smoke test",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "call scripts\\test_ticket_stack.cmd --smoke-only"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "webscraper-smoke",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:ultimate --help",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if not exist .venv-webscraper\\Scripts\\activate.bat (echo [ERROR] Missing .venv-webscraper. Run \"webscraper:venv+deps\" first. & exit /b 1) && call .venv-webscraper\\Scripts\\activate.bat && python -m webscraper.ultimate_scraper --help"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:legacy --help",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        ".venv-webscraper\\Scripts\\python.exe webscraper\\legacy\\ticket_scraper.py --help && .venv-webscraper\\Scripts\\python.exe webscraper\\legacy\\scrape_vpbx_tables.py --help && .venv-webscraper\\Scripts\\python.exe webscraper\\legacy\\extract_browser_cookies.py --help"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:chrome debug setup",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "call webscraper\\chrome_debug_setup.bat"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:cookies live",
      "type": "process",
      "command": "cmd.exe",
      "dependsOn": [
        "webscraper:chrome debug setup"
      ],
      "dependsOrder": "sequence",
      "args": [
        "/d",
        "/c",
        ".venv-webscraper\\Scripts\\python.exe webscraper\\chrome_cookies_live.py"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    }
  ]
}
