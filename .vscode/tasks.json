{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "dev: traceroute (inspect 9230)",
      "type": "process",
      "command": "npm.cmd",
      "args": [
        "run",
        "dev",
        "--",
        "-p",
        "3000"
      ],
      "isBackground": true,
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "\u25b2 Next\\.js",
            "endsPattern": "Ready in"
          }
        }
      ],
      "options": {
        "cwd": "${workspaceFolder}/traceroute-visualizer-main/traceroute-visualizer-main",
        "env": {
          "NODE_OPTIONS": "--inspect=9230"
        }
      }
    },
    {
      "label": "dev: deploy-ui (inspect 9232)",
      "type": "process",
      "command": "npm.cmd",
      "args": [
        "run",
        "dev"
      ],
      "isBackground": true,
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "VITE v",
            "endsPattern": "Local:\\s+http://"
          }
        }
      ],
      "options": {
        "cwd": "${workspaceFolder}/freepbx-deploy-ui",
        "env": {
          "NODE_OPTIONS": "--inspect=9232"
        }
      }
    },
    {
      "label": "dev: polycom app (inspect 9233)",
      "type": "process",
      "command": "npm.cmd",
      "args": [
        "run",
        "dev"
      ],
      "isBackground": true,
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "VITE v",
            "endsPattern": "Local:\\s+http://"
          }
        }
      ],
      "options": {
        "cwd": "${workspaceFolder}/PolycomYealinkMikrotikSwitchConfig-main/PolycomYealinkMikrotikSwitchConfig-main",
        "env": {
          "NODE_OPTIONS": "--inspect=9233"
        }
      }
    },
    {
      "label": "dev: deploy-backend (debugpy 5678)",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "call",
        "${workspaceFolder}\\scripts\\run_py.bat",
        "freepbx-deploy-backend\\.venv",
        "-m",
        "debugpy",
        "--listen",
        "127.0.0.1:5678",
        "--wait-for-client",
        "-m",
        "uvicorn",
        "freepbx_deploy_backend.main:app",
        "--reload",
        "--host",
        "127.0.0.1",
        "--port",
        "8002"
      ],
      "isBackground": true,
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "0\\.",
            "endsPattern": "Waiting for client"
          }
        }
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      }
    },
    {
      "label": "dev: webscraper (debugpy 5679)",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "call",
        "${workspaceFolder}\\scripts\\run_py.bat",
        ".venv-webscraper",
        "-m",
        "debugpy",
        "--listen",
        "127.0.0.1:5679",
        "--wait-for-client",
        "webscraper\\dev_server.py"
      ],
      "isBackground": true,
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "0\\.",
            "endsPattern": "Waiting for client"
          }
        }
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      }
    },
    {
      "label": "dev: cli manager",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "py",
        "-3",
        "freepbx_tools_manager.py"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "open: traceroute ui",
      "type": "process",
      "command": "powershell.exe",
      "args": [
        "-NoProfile",
        "-Command",
        "while(-not (Test-NetConnection 127.0.0.1 -Port 3000).TcpTestSucceeded){Start-Sleep -Milliseconds 300}; Start-Process 'http://127.0.0.1:3000/'"
      ],
      "problemMatcher": []
    },
    {
      "label": "open: webscraper ui",
      "type": "process",
      "command": "powershell.exe",
      "args": [
        "-NoProfile",
        "-Command",
        "while(-not (Test-NetConnection 127.0.0.1 -Port 8787).TcpTestSucceeded){Start-Sleep -Milliseconds 300}; Start-Process 'http://127.0.0.1:8787/'"
      ],
      "problemMatcher": []
    },
    {
      "label": "kill: debug ports",
      "type": "process",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "for %P in (9230 9232 9233 5678 5679) do @for /f \"tokens=5\" %a in ('netstat -ano ^| findstr /r /c:\":%P .*LISTENING\"') do @taskkill /F /PID %a >nul 2>&1"
      ],
      "problemMatcher": [],
      "options": {
        "cwd": "${workspaceFolder}"
      }
    },
    {
      "label": "Start Everything + CLI",
      "dependsOn": [
        "dev: traceroute (inspect 9230)",
        "dev: deploy-ui (inspect 9232)",
        "dev: polycom app (inspect 9233)",
        "dev: deploy-backend (debugpy 5678)",
        "dev: webscraper (debugpy 5679)",
        "dev: cli manager",
        "open: traceroute ui",
        "open: webscraper ui"
      ],
      "dependsOrder": "parallel",
      "problemMatcher": []
    }
  ]
}
