// NOTE: VSCode tasks.json does not provide a native compound task that terminates
// all running terminals/tasks; use the explicit Stop Everything/Stop All tasks below.
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start Everything + CLI",
      "dependsOn": [
        "traceroute-visualizer:dev",
        "polycom-yealink-mikrotik:dev",
        "freepbx-deploy-backend:dev",
        "freepbx-deploy-ui:dev",
        "freepbx-tools-manager:cli"
      ],
      "dependsOrder": "parallel",
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "traceroute-visualizer:dev",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "npm run dev"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "â–² Next\\.js",
            "endsPattern": "Ready in"
          }
        }
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/traceroute-visualizer-main/traceroute-visualizer-main"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "traceroute-visualizer:open",
      "type": "shell",
      "command": "cmd.exe",
      "dependsOn": [
        "traceroute-visualizer:dev"
      ],
      "dependsOrder": "sequence",
      "args": [
        "/d",
        "/c",
        "start \"\" \"http://localhost:3000\""
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "polycom-yealink-mikrotik:dev",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "npm run dev -- --port 5173"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "VITE v",
            "endsPattern": "Local:\\s+http://"
          }
        }
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/PolycomYealinkMikrotikSwitchConfig-main/PolycomYealinkMikrotikSwitchConfig-main"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "freepbx-deploy-backend:dev",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "py -3 -m uvicorn freepbx_deploy_backend.main:app --reload --host 127.0.0.1 --port 8002"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "INFO:\\s+Started server process",
            "endsPattern": "INFO:\\s+Uvicorn running on"
          }
        }
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/freepbx-deploy-backend"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "freepbx-deploy-ui:dev",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "npm run dev -- --port 5174"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "VITE v",
            "endsPattern": "Local:\\s+http://"
          }
        }
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/freepbx-deploy-ui"
      },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "freepbx-tools-manager:cli",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "py -3 freepbx_tools_manager.py"
      ],
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": ".*"
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "M A N A G E R",
            "endsPattern": "Main Menu:"
          }
        }
      ],
      "isBackground": true,
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "Stop All",
      "dependsOn": ["Stop Everything"],
      "dependsOrder": "parallel",
      "problemMatcher": [],
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "Stop Everything",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "for %%P in (3000 5173 5174 8002) do for /f \"tokens=5\" %%A in ('netstat -ano ^| findstr /R /C:\":%%P \" ^| findstr LISTENING') do taskkill /F /PID %%A >NUL 2>&1 & for /f \"tokens=2 delims==;\" %%A in ('wmic process where \"CommandLine like '%%freepbx_tools_manager.py%%'\" get ProcessId /value ^| find \"ProcessId\"') do taskkill /F /PID %%A >NUL 2>&1"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:test all (cmd)",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "call scripts\\test_webscraper_cmd.bat"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:test all (cmd) (live cookies)",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "set WEBSCRAPER_LIVE_COOKIES=1 && call scripts\\test_webscraper_cmd.bat"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:venv+deps",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "if not exist .venv-webscraper (py -3.12 -m venv .venv-webscraper) && .venv-webscraper\\Scripts\\python.exe -m pip install -U pip && .venv-webscraper\\Scripts\\pip.exe install -r webscraper\\requirements.txt"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:smoke",
      "type": "shell",
      "command": "${workspaceFolder}\\.venv-webscraper\\Scripts\\python.exe",
      "args": ["-m", "webscraper._smoke_test"],
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:ultimate --help",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        ".venv-webscraper\\Scripts\\python.exe webscraper\\ultimate_scraper.py --help"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:legacy --help",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        ".venv-webscraper\\Scripts\\python.exe webscraper\\legacy\\ticket_scraper.py --help && .venv-webscraper\\Scripts\\python.exe webscraper\\legacy\\scrape_vpbx_tables.py --help && .venv-webscraper\\Scripts\\python.exe webscraper\\legacy\\extract_browser_cookies.py --help"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:chrome debug setup",
      "type": "shell",
      "command": "cmd.exe",
      "args": [
        "/d",
        "/c",
        "call webscraper\\chrome_debug_setup.bat"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    },
    {
      "label": "webscraper:cookies live",
      "type": "shell",
      "command": "cmd.exe",
      "dependsOn": [
        "webscraper:chrome debug setup"
      ],
      "dependsOrder": "sequence",
      "args": [
        "/d",
        "/c",
        ".venv-webscraper\\Scripts\\python.exe webscraper\\chrome_cookies_live.py"
      ],
      "problemMatcher": [],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": {
        "panel": "dedicated",
        "group": "dev",
        "reveal": "always",
        "clear": false
      }
    }
  ]
}
